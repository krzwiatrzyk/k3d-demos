version: 3

tasks:
  create:tlsstore:
    env:
      DOMAIN: '{{ .DOMAIN }}'
    cmds:
    - envsubst < manifests/acme-tlsstore.yaml | kubectl apply -f -
    
  install:ingress-route:
    cmds:
    - kubectl apply -f manifests/ingress-route.yaml

  update:
  - >
    helm secrets upgrade traefik traefik/traefik
    -n kube-system
    --reuse-values
    -f values.yaml
    -f secrets.yaml